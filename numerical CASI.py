
# Author: Ruichen Zhang，未经原作者许可，禁止商用。

# e<1

from math import pi, cos, sin, floor, sqrt, exp, log


def CSI(e,M):
    M_r = M
    sm = sin(M_r)
    cm = cos(M_r)
    sm9 = sm**9
    sm11 = sm**11
    sm13 = sm**13
    cm2=cm**2
    cm3=cm**3
    cm4=cm**4
    cm5=cm**5
    cm6=cm**6
    cm7=cm**7
    cm8=cm**8
    cm9=cm**9
    cm10=cm**10
    cm11=cm**11
    cm12=cm**12
    cm13=cm**13
    sm7=sm**7
    sm5=sm**5
    sm3=sm**3
    sm15=sm**15
    s2m = 2*sm*cm
    s3m = -4*sm**3+3*sm
    s4m = 4*cm**3*sm - 4*cm*sm**3
    s5m= 5 *cm4 *sm - 10 *cm2 *sm3 + sm5
    s6m= 6 *cm5 *sm - 20 *cm3 *sm3 + 6 *cm *sm5
    s7m= 7 *cm6 *sm - 35 *cm4 *sm3 + 21 *cm2 *sm5 - sm7
    s8m= 8 *cm7 *sm - 56 *cm5 *sm3 + 56 *cm3 *sm5 - 8 *cm *sm7
    s9m= 9 *cm8 *sm - 84 *cm6 *sm3 + 126 *cm4 *sm5 - 36 *cm2 *sm7 + sm9
    s10m= 10 *cm9 *sm - 120 *cm7 *sm3 + 252 *cm5 *sm5 - 120 *cm3 *sm7 + 10 *cm *sm9
    s11m= 11 *cm10 *sm - 165 *cm8 *sm3 + 462 *cm6 *sm5 - 330 *cm4 *sm7 + 55 *cm2 *sm9 - sm11
    s12m= 12 *cm11 *sm - 220 *cm9 *sm3 + 792 *cm7 *sm5 - 792 *cm5 *sm7 + 220 *cm3 *sm9 - 12 *cm *sm11
    s13m= 13 *cm12 *sm - 286 *cm10 *sm3 + 1287 *cm8 *sm5 - 1716 *cm6 *sm7+ 715 *cm4 *sm9 - 78 *cm2 *sm11 + sm**13
    s14m= 14 *cm13 *sm - 364 *cm11 *sm3 + 2002 *cm9 *sm5 - 3432 *cm7 *sm7 + 2002 *cm5 *sm9 - 364 *cm3 *sm11 + 14 *cm *sm**13
    s15m= 15 *cm**14 *sm - 455 *cm12 *sm3 + 3003 *cm10 *sm5 - 6435 *cm8 *sm7 + 5005 *cm6 *sm9 - 1365 *cm4 *sm11 + 105 *cm2 *sm**13 - sm15
    s16m= 16 *cm**15 *sm - 560 *cm13 *sm3 + 4368 *cm11 *sm5 - 11440 *cm9 *sm7 + 11440 *cm7 *sm9 - 4368 *cm5 *sm11 + 560 *cm3 *sm**13 - 16 *cm *sm15
    s17m= 17 *cm**16 *sm - 680 *cm**14 *sm3 + 6188 *cm12 *sm5 - 19448 *cm10 *sm7 + 24310 *cm8 *sm9 - 12376 *cm6 *sm11 + 2380 *cm4 *sm**13 - 136 *cm2 *sm15 + sm**17

    BB = -e *sm - e**2 *cm *sm - 1/8 *e**3 *(-sm + 3 *s3m) - 1/6 *e**4 *(-s2m + 2 *s4m) - 1/384 *e**5 * (2 *sm - 81 *s3m + 125 *s5m) - 1/240 *e**6* (5 *s2m - 64 *s4m + 81 *s6m) - (e**7 *(-5 *sm + 2187 *s3m - 15625 *s5m + 16807 *s7m))/46080 - (e**8 *(-7 *s2m + 448 *s4m - 2187 *s6m + 2048 *s8m))/5040 - (e**9 * (14 *sm - 61236 *s3m + 1562500 *s5m - 5764801 *s7m + 4782969 *s9m))/10321920 - (e**10 * (42 *s2m - 12288 *s4m + 177147 *s6m - 524288 *s8m + 390625 *s10m))/725760 - (e**11* (-42 *sm + 1771470 *s3m - 146484375 *s5m + 1412376245 *s7m - 3486784401 *s9m + 2357947691 *s11m))/3715891200 - (e**12 *(-66 *s2m + 84480 *s4m - 3247695 *s6m + 23068672 *s8m - 48828125 *s10m + 30233088 *s12m))/39916800 - (e**13 * (132 *sm - 52612659 *s3m + 13427734375 *s5m - 304508318422 *s7m + 1694577218886 *s9m - 3138428376721 *s11m + 1792160394037 *s13m))/1961990553600 - (e**14 *(429 *s2m - 2342912 *s4m + 227988189 *s6m - 3489660928 *s8m + 15869140625 *s10m - 26121388032 *s12m + 13841287201 *s14m))/12454041600 - (1/1428329123020800)*e**15* (-429 *sm + 1595917323 *s3m - 1221923828125 *s5m + 61718299629259 *s7m - 693929371133817 *s9m + 2658248835082687 *s11m - 3937376385699289 *s13m + 1946195068359375 *s15m) - (1/1307674368000)*e**16 *(-715 *s2m + 16400384 *s4m - 3917251611 *s6m + 122138132480 *s8m - 1068115234375 *s10m + 3526387384320 *s12m - 4747561509943 *s14m + 2199023255552 *s16m) - (1/1371195958099968000)*e**17 *(1430 *sm - 49245448824 *s3m + 111083984375000 *s5m - 12096786727334764 *s7m + 259422826439257740 *s9m - 1837989194542886440 *s11m + 5323332873465438728 *s13m - 6568408355712890625 *s15m + 2862423051509815793 *s17m)
    AA = M_r - BB

    return AA
